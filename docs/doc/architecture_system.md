# Архитектура системы тестирования

## Общая архитектурная диаграмма

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        Пользовательский интерфейс                        │
└───────────────────────────────────┬─────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                               API-шлюз                                   │
└───────┬───────────────────────────┬───────────────────────────┬─────────┘
        │                           │                           │
        ▼                           ▼                           ▼
┌───────────────┐         ┌───────────────┐           ┌───────────────┐
│  Сервис       │         │  Сервис       │           │  Сервис       │
│  управления   │         │  выполнения   │           │  результатов  │
│  устройствами │         │  тестов       │           │  тестов       │
└───────┬───────┘         └───────┬───────┘           └───────┬───────┘
        │                         │                           │
        │                         │                           │
        ▼                         ▼                           ▼
┌───────────────┐         ┌───────────────┐           ┌───────────────┐
│  База данных  │         │  Robot        │           │  База данных  │
│  конфигураций │         │  Framework    │           │  результатов  │
└───────────────┘         └───────┬───────┘           └───────────────┘
                                  │
                                  │
                                  ▼
                          ┌───────────────┐
                          │  Уровень      │
                          │  интеграции с │
                          │  оборудованием│
                          └───────┬───────┘
                                  │
                                  │
                                  ▼
                          ┌───────────────┐
                          │  Физические   │
                          │  устройства   │
                          │  (Orange Pi,  │
                          │  коммутатор,  │
                          │  роутер,      │
                          │  программатор)│
                          └───────────────┘
```

## Детальная архитектура микросервисов

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        Пользовательский интерфейс                        │
│                                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │  Панель     │  │  Управление │  │ Просмотрщик │  │ Интерфейс   │    │
│  │  управления │  │  тестами    │  │ результатов │  │ конфигурации│    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                         │
└───────────────────────────────────┬─────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                               API-шлюз                                   │
│                                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ Маршрутизация│  │ Аутентифи- │  │ Ограничение │  │ Кэширование │    │
│  │ запросов    │  │ кация       │  │ запросов    │  │             │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                         │
└───────┬───────────────────────────┬───────────────────────────┬─────────┘
        │                           │                           │
        ▼                           ▼                           ▼
┌───────────────────┐     ┌───────────────────┐       ┌───────────────────┐
│  Сервис управления│     │  Сервис выполнения│       │  Сервис результатов│
│  устройствами     │     │  тестов           │       │  тестов           │
│                   │     │                   │       │                   │
│  ┌─────────────┐  │     │  ┌─────────────┐  │       │  ┌─────────────┐  │
│  │ Управление  │  │     │  │ Планировщик │  │       │  │ Хранение    │  │
│  │ конфигурацией│  │     │  │ тестов     │  │       │  │ результатов │  │
│  └─────────────┘  │     │  └─────────────┘  │       │  └─────────────┘  │
│                   │     │                   │       │                   │
│  ┌─────────────┐  │     │  ┌─────────────┐  │       │  ┌─────────────┐  │
│  │ Мониторинг  │  │     │  │ Исполнитель │  │       │  │ Анализ      │  │
│  │ устройств   │  │     │  │ тестов     │  │       │  │ результатов │  │
│  └─────────────┘  │     │  └─────────────┘  │       │  └─────────────┘  │
│                   │     │                   │       │                   │
│  ┌─────────────┐  │     │  ┌─────────────┐  │       │  ┌─────────────┐  │
│  │ Обновление  │  │     │  │ Управление  │  │       │  │ Генерация   │  │
│  │ прошивок    │  │     │  │ тест. данными│  │       │  │ отчетов    │  │
│  └─────────────┘  │     │  └─────────────┘  │       │  └─────────────┘  │
└───────┬───────────┘     └───────┬───────────┘       └───────┬───────────┘
        │                         │                           │
        │                         │                           │
        ▼                         ▼                           ▼
┌───────────────┐         ┌───────────────┐           ┌───────────────┐
│  База данных  │         │  Robot        │           │  База данных  │
│  конфигураций │         │  Framework    │           │  результатов  │
└───────────────┘         └───────┬───────┘           └───────────────┘
                                  │
                                  │
                                  ▼
                          ┌───────────────────────────────────┐
                          │      Уровень интеграции с         │
                          │          оборудованием            │
                          │                                   │
                          │  ┌─────────────┐ ┌─────────────┐  │
                          │  │ Адаптер     │ │ Адаптер     │  │
                          │  │ Orange Pi   │ │ коммутатора │  │
                          │  └─────────────┘ └─────────────┘  │
                          │                                   │
                          │  ┌─────────────┐ ┌─────────────┐  │
                          │  │ Адаптер     │ │ Адаптер     │  │
                          │  │ роутера     │ │ программатора│  │
                          │  └─────────────┘ └─────────────┘  │
                          │                                   │
                          └───────────────┬───────────────────┘
                                          │
                                          │
                                          ▼
                                  ┌───────────────┐
                                  │  Физические   │
                                  │  устройства   │
                                  └───────────────┘
```

## Архитектура событийно-ориентированной коммуникации

```
┌─────────────────────────────────────────────────────────────────────────┐
│                             Шина событий                                 │
│                                                                         │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐         │
│  │ Событие запуска │  │ Событие         │  │ Событие         │         │
│  │ теста           │  │ завершения теста│  │ изменения       │         │
│  └─────────────────┘  └─────────────────┘  │ конфигурации    │         │
│                                            └─────────────────┘         │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐         │
│  │ Событие         │  │ Событие         │  │ Событие         │         │
│  │ статуса         │  │ ошибки          │  │ уведомления     │         │
│  │ устройства      │  │                 │  │                 │         │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘         │
│                                                                         │
└───┬───────────────────┬───────────────────┬───────────────────┬─────────┘
    │                   │                   │                   │
    │                   │                   │                   │
    ▼                   ▼                   ▼                   ▼
┌─────────────┐   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐
│  Сервис     │   │  Сервис     │   │  Сервис     │   │  Сервис     │
│  управления │   │  выполнения │   │  результатов│   │  уведомлений│
│  устройствами│   │  тестов     │   │  тестов     │   │             │
└─────────────┘   └─────────────┘   └─────────────┘   └─────────────┘
```

## Архитектура Event Sourcing + CQRS для результатов тестов

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         Клиентские запросы                               │
└───────────────┬─────────────────────────────────────┬───────────────────┘
                │                                     │
                ▼                                     ▼
┌───────────────────────────┐             ┌───────────────────────────┐
│      Команды (Записи)     │             │      Запросы (Чтения)     │
└───────────────┬───────────┘             └───────────────┬───────────┘
                │                                         │
                ▼                                         ▼
┌───────────────────────────┐             ┌───────────────────────────┐
│     Сервис команд         │             │     Сервис запросов       │
│                           │             │                           │
│  ┌─────────────────────┐  │             │  ┌─────────────────────┐  │
│  │ Запуск теста        │  │             │  │ Получение результатов│  │
│  └─────────────────────┘  │             │  └─────────────────────┘  │
│                           │             │                           │
│  ┌─────────────────────┐  │             │  ┌─────────────────────┐  │
│  │ Обновление статуса  │  │             │  │ Получение статистики│  │
│  └─────────────────────┘  │             │  └─────────────────────┘  │
│                           │             │                           │
│  ┌─────────────────────┐  │             │  ┌─────────────────────┐  │
│  │ Сохранение результата│  │             │  │ Получение отчетов   │  │
│  └─────────────────────┘  │             │  └─────────────────────┘  │
└───────────────┬───────────┘             └───────────────┬───────────┘
                │                                         │
                ▼                                         │
┌───────────────────────────┐                            │
│     Хранилище событий     │                            │
│                           │                            │
│  ┌─────────────────────┐  │                            │
│  │ Событие запуска теста│  │                            │
│  └─────────────────────┘  │                            │
│                           │                            │
│  ┌─────────────────────┐  │                            │
│  │ Событие обновления  │  │                            │
│  │ статуса             │  │                            │
│  └─────────────────────┘  │                            │
│                           │                            │
│  ┌─────────────────────┐  │                            │
│  │ Событие сохранения  │  │                            │
│  │ результата          │  │                            │
│  └─────────────────────┘  │                            │
└───────────────┬───────────┘                            │
                │                                         │
                ▼                                         │
┌───────────────────────────┐                            │
│     Проекции данных       │◄───────────────────────────┘
│                           │
│  ┌─────────────────────┐  │
│  │ Текущие статусы     │  │
│  │ тестов              │  │
│  └─────────────────────┘  │
│                           │
│  ┌─────────────────────┐  │
│  │ Статистика по тестам│  │
│  └─────────────────────┘  │
│                           │
│  ┌─────────────────────┐  │
│  │ Отчеты по результатам│  │
│  └─────────────────────┘  │
└───────────────────────────┘
```

## Архитектура уровня интеграции с оборудованием

```
┌─────────────────────────────────────────────────────────────────────────┐
│                 Уровень интеграции с оборудованием                       │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                  Интерфейс устройства                           │    │
│  │                                                                 │    │
│  │    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐       │    │
│  │    │ Подключение │    │ Выполнение  │    │ Получение   │       │    │
│  │    │             │    │ команд      │    │ статуса     │       │    │
│  │    └─────────────┘    └─────────────┘    └─────────────┘       │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                         │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐         │
│  │ Адаптер Orange Pi│  │ Адаптер         │  │ Адаптер         │         │
│  │                 │  │ коммутатора      │  │ роутера         │         │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘         │
│                                                                         │
│  ┌─────────────────┐  ┌─────────────────────────────────────────┐      │
│  │ Адаптер         │  │           Фабрика адаптеров             │      │
│  │ программатора   │  │                                         │      │
│  └─────────────────┘  └─────────────────────────────────────────┘      │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                  Менеджер конфигурации                          │    │
│  │                                                                 │    │
│  │    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐       │    │
│  │    │ Загрузка    │    │ Сохранение  │    │ Валидация   │       │    │
│  │    │ конфигурации│    │ конфигурации│    │ конфигурации│       │    │
│  │    └─────────────┘    └─────────────┘    └─────────────┘       │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                         │
└─────────────────────────────────┬───────────────────────────────────────┘
                                  │
                                  ▼
                          ┌───────────────┐
                          │  Физические   │
                          │  устройства   │
                          └───────────────┘
```
